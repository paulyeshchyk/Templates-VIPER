//
//  {{ prefix }}{{ module_info.name }}{{ module_info.file_name }}
//  {{ module_info.project_name }}
//
//  Created by {{ developer.name }} on {{ date }}.
//  Copyright {{ year }} {{ developer.company }}. All rights reserved.
//

import Foundation
import UIKit

class {{ prefix }}{{ module_info.name }}Presenter: NSObject, {{ prefix }}{{ module_info.name }}PresenterProtocol {

    var splitView: {{ prefix }}{{ module_info.name }}ViewProtocol
    var interactor: {{ prefix }}{{ module_info.name }}InteractorProtocol?
    var selectedItem: {{ prefix }}{{ module_info.name }}Model? {

        didSet {

            self.interactor?.selectedItem = self.selectedItem
            self.rebuildPresenters()
        }
    }

    var masterPresenter:PresenterProtocol? {

        didSet {

            self.rebuildPresenters()
        }
    }

    var detailPresenter:PresenterProtocol? {

        didSet {

            self.rebuildPresenters()
        }
    }

    var emptyDetailPresenter:PresenterProtocol? {

        didSet {

            self.rebuildPresenters()
        }
    }

    var viewController: UIViewController {

        get {

            return splitView.viewController
        }
    }

    required init(view:{{ prefix }}{{ module_info.name }}ViewProtocol, splitInteractor:{{ prefix }}{{ module_info.name }}InteractorProtocol) {

        splitView = view
        interactor = splitInteractor
    }


    //MARK: - private

    func rebuildPresenters() {

        guard let interactor = self.interactor else {

            return
        }

        var vcs:[UIViewController] = []

        guard let master = self.masterPresenter else {

            return
        }
        vcs.append(master.viewController)


        let hasSelectedItem = interactor.selectedItem

        if ((hasSelectedItem != nil) && hasSelectedItem?.text.characters.count != 0) {

            guard let detail = self.detailPresenter else {

                return
            }

            vcs.append(detail.viewController)
        } else {

            guard let emptyDetail = self.emptyDetailPresenter else {

                return
            }
            vcs.append(emptyDetail.viewController)
        }

        splitView.setSplittedControllers(vcs)
    }
}

